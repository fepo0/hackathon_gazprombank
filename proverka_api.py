import json
import os
import sys
from typing import Any, Dict

import requests


def main():
    base_url = os.environ.get("API_BASE_URL", "http://127.0.0.1:8000")
    url = f"{base_url}/predict"

    payload: Dict[str, Any] = {
        "data": [
            {
                "id": 1,
                "text": """02.09.2025 в 16:40 ко мне приезжала представитель Анна для доставки дебетовой карты и ее активации. Я несколько раз менял место встречи, Анна вошла в положение и приехала в удобное мне место между моими встречами и работой. Хочу отметить ее профессионализм и отзывчивость.

Она во всех подробностях рассказала про преимущества продуктов банка, про само обслуживание карты, рассказала и предложила все продукты банка во всех подробностях, ответила на все мои вопросы. Я заинтересовался бонусной программой по кэш бекам, мне было все подробно разложено и показано в приложении как пользоваться и что подключить.

Видно, что Анна действительно разбирается в том, что предлагает и хочет помочь клиенту извлечь максимум пользы в использовании продуктов банка. Было очень приятно данное обслуживание, встреча длилась не более 30 минут, но за это время я получил всю нужную мне информацию и даже больше. Очень терпеливый человек и приятная девушка, побольше бы таких сотрудников. Выражаю ей большую благодарность, она однозначно достойна премирования!""",
            },
            {
                "id": 2,
                "text": "23.09.2025 было зачисление 50% от моей заработной платы,на зарплатой карте есть аресты,но у этим арестам есть распоряжение у банка "
                        "о сохранении прожиточного минимума,7 дней уже прошло,баланс в минусе,поддержка ничего внятного сказать не одет,сформировала обращение и "
                        "сказала ждать до 17.10.2025 т.е 3 недели,сегодня срок ещё на 3 дня увеличили до 20.10 2025.Просто оставили без средств к существованию ",
            }
        ]
    }

    headers = {"Content-Type": "application/json; charset=utf-8"}
    try:
        resp = requests.post(url, data=json.dumps(payload, ensure_ascii=False).encode("utf-8"), headers=headers, timeout=180)
    except requests.RequestException as e:
        print(f"Request failed: {e}")
        sys.exit(1)

    print(f"Status: {resp.status_code}")
    try:
        print(json.dumps(resp.json(), ensure_ascii=False, indent=2))
    except Exception:
        print(resp.text)


if __name__ == "__main__":
    main()